[{"create-time":1676449993069,"title":"roam/js/bulletpaths",":create/user":{":user/uid":"xxfWvZEhaJXNFc4z4T9DtquVcMb2"},"children":[{"edit-time":1676450068426,"children":[{"string":"```javascript\n/*\n * credit to Dhrumil Shah (@wandcrafting) and Robert Haisfield (@RobertHaisfield)\n * for the original concept which was part of their RoamGames submission\n * and can be found at: https://www.figma.com/file/5shwLdUCHxSaPNEO7pazbe/\n *\n */\n\n/* ======= OPTIONS ======== */\n/* note: if you change these, reload the page to see the effect */\n\n// BULLET\nlet scale = 2;\nlet bulletColor = '#FF0099';\n\n// LINES\nlet showLines = true;\nlet lineWidth = 2;\nlet lineColor = bulletColor;\nlet borderRadius = 5;\n\n// HIGHLIGHT REFS\nlet highlightRefs = true;\nlet refColor = bulletColor;\n\n/* ======= LIBRARIES ======== */\n\n/*\n * arrive.js\n * v2.4.1\n * https://github.com/uzairfarooq/arrive\n * MIT licensed\n *\n * Copyright (c) 2014-2017 Uzair Farooq\n */\n\nvar Arrive=function(e,t,n){\"use strict\";function r(e,t,n){l.addMethod(t,n,e.unbindEvent),l.addMethod(t,n,e.unbindEventWithSelectorOrCallback),l.addMethod(t,n,e.unbindEventWithSelectorAndCallback)}function i(e){e.arrive=f.bindEvent,r(f,e,\"unbindArrive\"),e.leave=d.bindEvent,r(d,e,\"unbindLeave\")}if(e.MutationObserver&&\"undefined\"!=typeof HTMLElement){var o=0,l=function(){var t=HTMLElement.prototype.matches||HTMLElement.prototype.webkitMatchesSelector||HTMLElement.prototype.mozMatchesSelector||HTMLElement.prototype.msMatchesSelector;return{matchesSelector:function(e,n){return e instanceof HTMLElement&&t.call(e,n)},addMethod:function(e,t,r){var i=e[t];e[t]=function(){return r.length==arguments.length?r.apply(this,arguments):\"function\"==typeof i?i.apply(this,arguments):n}},callCallbacks:function(e,t){t&&t.options.onceOnly&&1==t.firedElems.length&&(e=[e[0]]);for(var n,r=0;n=e[r];r++)n&&n.callback&&n.callback.call(n.elem,n.elem);t&&t.options.onceOnly&&1==t.firedElems.length&&t.me.unbindEventWithSelectorAndCallback.call(t.target,t.selector,t.callback)},checkChildNodesRecursively:function(e,t,n,r){for(var i,o=0;i=e[o];o++)n(i,t,r)&&r.push({callback:t.callback,elem:i}),i.childNodes.length>0&&l.checkChildNodesRecursively(i.childNodes,t,n,r)},mergeArrays:function(e,t){var n,r={};for(n in e)e.hasOwnProperty(n)&&(r[n]=e[n]);for(n in t)t.hasOwnProperty(n)&&(r[n]=t[n]);return r},toElementsArray:function(t){return n===t||\"number\"==typeof t.length&&t!==e||(t=[t]),t}}}(),c=function(){var e=function(){this._eventsBucket=[],this._beforeAdding=null,this._beforeRemoving=null};return e.prototype.addEvent=function(e,t,n,r){var i={target:e,selector:t,options:n,callback:r,firedElems:[]};return this._beforeAdding&&this._beforeAdding(i),this._eventsBucket.push(i),i},e.prototype.removeEvent=function(e){for(var t,n=this._eventsBucket.length-1;t=this._eventsBucket[n];n--)if(e(t)){this._beforeRemoving&&this._beforeRemoving(t);var r=this._eventsBucket.splice(n,1);r&&r.length&&(r[0].callback=null)}},e.prototype.beforeAdding=function(e){this._beforeAdding=e},e.prototype.beforeRemoving=function(e){this._beforeRemoving=e},e}(),a=function(t,r){var i=new c,o=this,a={fireOnAttributesModification:!1};return i.beforeAdding(function(n){var i,l=n.target;(l===e.document||l===e)&&(l=document.getElementsByTagName(\"html\")[0]),i=new MutationObserver(function(e){r.call(this,e,n)});var c=t(n.options);i.observe(l,c),n.observer=i,n.me=o}),i.beforeRemoving(function(e){e.observer.disconnect()}),this.bindEvent=function(e,t,n){t=l.mergeArrays(a,t);for(var r=l.toElementsArray(this),o=0;o<r.length;o++)i.addEvent(r[o],e,t,n)},this.unbindEvent=function(){var e=l.toElementsArray(this);i.removeEvent(function(t){for(var r=0;r<e.length;r++)if(this===n||t.target===e[r])return!0;return!1})},this.unbindEventWithSelectorOrCallback=function(e){var t,r=l.toElementsArray(this),o=e;t=\"function\"==typeof e?function(e){for(var t=0;t<r.length;t++)if((this===n||e.target===r[t])&&e.callback===o)return!0;return!1}:function(t){for(var i=0;i<r.length;i++)if((this===n||t.target===r[i])&&t.selector===e)return!0;return!1},i.removeEvent(t)},this.unbindEventWithSelectorAndCallback=function(e,t){var r=l.toElementsArray(this);i.removeEvent(function(i){for(var o=0;o<r.length;o++)if((this===n||i.target===r[o])&&i.selector===e&&i.callback===t)return!0;return!1})},this},s=function(){function e(e){var t={attributes:!1,childList:!0,subtree:!0};return e.fireOnAttributesModification&&(t.attributes=!0),t}function t(e,t){e.forEach(function(e){var n=e.addedNodes,i=e.target,o=[];null!==n&&n.length>0?l.checkChildNodesRecursively(n,t,r,o):\"attributes\"===e.type&&r(i,t,o)&&o.push({callback:t.callback,elem:i}),l.callCallbacks(o,t)})}function r(e,t){return l.matchesSelector(e,t.selector)&&(e._id===n&&(e._id=o++),-1==t.firedElems.indexOf(e._id))?(t.firedElems.push(e._id),!0):!1}var i={fireOnAttributesModification:!1,onceOnly:!1,existing:!1};f=new a(e,t);var c=f.bindEvent;return f.bindEvent=function(e,t,r){n===r?(r=t,t=i):t=l.mergeArrays(i,t);var o=l.toElementsArray(this);if(t.existing){for(var a=[],s=0;s<o.length;s++)for(var u=o[s].querySelectorAll(e),f=0;f<u.length;f++)a.push({callback:r,elem:u[f]});if(t.onceOnly&&a.length)return r.call(a[0].elem,a[0].elem);setTimeout(l.callCallbacks,1,a)}c.call(this,e,t,r)},f},u=function(){function e(){var e={childList:!0,subtree:!0};return e}function t(e,t){e.forEach(function(e){var n=e.removedNodes,i=[];null!==n&&n.length>0&&l.checkChildNodesRecursively(n,t,r,i),l.callCallbacks(i,t)})}function r(e,t){return l.matchesSelector(e,t.selector)}var i={};d=new a(e,t);var o=d.bindEvent;return d.bindEvent=function(e,t,r){n===r?(r=t,t=i):t=l.mergeArrays(i,t),o.call(this,e,t,r)},d},f=new s,d=new u;t&&i(t.fn),i(HTMLElement.prototype),i(NodeList.prototype),i(HTMLCollection.prototype),i(HTMLDocument.prototype),i(Window.prototype);var h={};return r(f,h,\"unbindAllArrive\"),r(d,h,\"unbindAllLeave\"),h}}(window,\"undefined\"==typeof jQuery?null:jQuery,void 0);\n\n/* ======= CODE ======== */\n\n// Add custom style tag to document for CSS customization\nlet style = document.createElement('style');\nlet baseStyle = `\n.path-highlighted .rm-bullet .rm-bullet__inner,\n.path-highlighted .rm-bullet .rm-bullet__inner--user-icon {\n    background-color: ${bulletColor} !important;\n    transform: scale(${scale});\n}\n`\nif(highlightRefs) {\n  baseStyle += `\n.path-highlighted + .roam-block .rm-page-ref,\n.path-highlighted + .roam-block .rm-alias {\n\tcolor: ${refColor};\n    scale: 2;\n\tborder-radius: 5px;\n\tborder: 2px solid ${refColor};\n\tpadding: 2px 5px 2px 5px;\n\ttransition: scale 0. 5s ease-in 1s;\n}\n.path-highlighted + .roam-block .rm-block-ref {\n\tborder-bottom-color: ${refColor};\n}\n`\n}\nstyle.textContent = baseStyle\ndocument.body.appendChild(style);\n\n// Remove classes when block is unfocused\ndocument.leave('textarea.rm-block-input', function(el) {\n    let bullets = [].slice.call(document.querySelectorAll('.path-highlighted'));\n\n    bullets.forEach(function(bullet) {\n        bullet.classList.remove('path-highlighted');\n    })\n})\n\n// Show highlighted bullets + path when block is focused\nlet pathid = 0;\ndocument.arrive('textarea.rm-block-input', function(el) {\n    let bullets = [];\n    let block = el.closest('.roam-block-container');\n    // iterate through parents and get bullet elements\n    while(block) {\n        bullets.push(block.querySelector('.controls'));\n        block = block.parentElement.closest('.roam-block-container')\n    }\n    \n    // bullet styles cannot be applied directly to the element because they are pseudotags\n    // so we'll create a style string and add it to the style tag we created earlier\n    let bulletStyle = ''\n    bullets.forEach(function(bullet, i) {\n        let lastBullet = i > 0 ? bullets[i-1] : null\n        // give each bullet a special path identifier so that we can target it directly\n        if(!bullet.dataset.pathidentifier) { bullet.dataset.pathidentifier = pathid++ }\n        \n        if(lastBullet != null && showLines == true) {\n            let bboxA = lastBullet.getBoundingClientRect()\n            let bboxB = bullet.getBoundingClientRect()\n\n            bulletStyle += `\n.path-highlighted[data-pathidentifier=\"${bullet.dataset.pathidentifier}\"] .bp3-popover-target::before {\n    content: \"\";\n    position: absolute;\n    top: 10px; left: 6px;\n    width: ${bboxA.x-bboxB.x}px; height: ${bboxA.y-bboxB.y}px;\n    border: ${lineWidth}px solid ${lineColor};\n    border-right: none;\n    border-top: none;\n    border-bottom-left-radius: ${borderRadius}px;\n    pointer-events: none;\n\tz-index: 11 !important;\n}\n`\n        }\n        \n        // highlight bullet\n        bullet.classList.add('path-highlighted')\n    })\n    \n    // set content of style tag to include both the base styles from before and the bullet styles we just generated\n    style.textContent = baseStyle + bulletStyle;\n})```","uid":"fwnxEj5RY","create-time":1614929711723,"edit-time":1623853096925,":create/user":{":user/uid":"CFcTR9akrLh7ypO5jZCdE8eZ7aG2"},":edit/user":{":user/uid":"CFcTR9akrLh7ypO5jZCdE8eZ7aG2"}}],"refs":[{"uid":"_Gh4v6vGQ"}],"uid":"n8CjJAR8Y",":block/refs":[{":block/uid":"_Gh4v6vGQ"}],"string":"{{[[roam/js]]}}",":create/user":{":user/uid":"xxfWvZEhaJXNFc4z4T9DtquVcMb2"},"create-time":1676449995180,":edit/user":{":user/uid":"xxfWvZEhaJXNFc4z4T9DtquVcMb2"}}],"uid":"Lvqrw2B70","edit-time":1676641775196,":edit/user":{":user/uid":"xxfWvZEhaJXNFc4z4T9DtquVcMb2"}}]